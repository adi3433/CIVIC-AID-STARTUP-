<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadGen AI | CivicAId</title>
    <link rel="icon" type="image/png" sizes="32x32" href="public/CivicLogo.png">
    <link rel="icon" type="image/png" sizes="64x64" href="public/CivicLogo.png">
    <link rel="icon" type="image/png" sizes="96x96" href="public/CivicLogo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="public/CivicLogo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js"></script>
    <!-- Markdown and Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
    const { animate, scroll } = Motion
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'civic-dark': '#0a0e1a',
                        'civic-surface': '#0f1420',
                        'civic-card': '#141b2d',
                    },
                    backdropBlur: {
                        'xl': '20px',
                    }
                }
            }
        }
    </script>
    <style>
        .glass-bg {
            background: rgba(10, 14, 26, 0.5);
        }
        
        /* Markdown Styles */
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .markdown-content h1 { font-size: 1.5rem; }
        .markdown-content h2 { font-size: 1.25rem; }
        .markdown-content h3 { font-size: 1.1rem; }
        .markdown-content p { margin-bottom: 0.75rem; line-height: 1.6; }
        .markdown-content ul, .markdown-content ol { 
            margin-left: 1.5rem; 
            margin-bottom: 0.75rem; 
            list-style: disc;
        }
        .markdown-content code {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .markdown-content pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #1FA3A3;
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
    </style>
</head>

<body class="bg-civic-dark text-white font-sans leading-relaxed min-h-screen overflow-x-hidden">
    <!-- Fixed Top Spotlight Effect -->
    <div class="fixed top-0 left-0 w-full h-[400px] pointer-events-none z-0" style="background: linear-gradient(180deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.18) 10%, rgba(255, 255, 255, 0.12) 20%, rgba(255, 255, 255, 0.08) 35%, rgba(255, 255, 255, 0.04) 55%, rgba(255, 255, 255, 0.01) 75%, transparent 100%); filter: blur(60px);"></div>
    
    <!-- Right Side Spotlight -->
    <div class="fixed top-[30%] right-[-10%] w-[800px] h-[800px] pointer-events-none z-0" style="background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.15) 15%, rgba(255, 255, 255, 0.1) 30%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 70%, transparent 100%); filter: blur(80px);"></div>

    <!-- Header - Premium Glassmorphism -->
    <header class="fixed top-0 left-0 right-0 z-50 glass-bg backdrop-blur-xl border-b border-white/[0.06]">
        <nav class="flex justify-between items-center py-4 px-10 max-w-[1400px] mx-auto">
            <a href="landing.html" class="flex items-center gap-3 text-lg font-semibold text-white no-underline group">
                <img src="public/CivicLogo.png" alt="CivicAId Logo" class="w-10 h-10 object-contain transition-transform group-hover:scale-110">
                <span class="group-hover:text-blue-400 transition-colors">CivicAId</span>
            </a>
            <div class="flex items-center gap-8">
                <a href="landing.html" class="text-white/70 no-underline text-sm font-medium hover:text-white transition-colors">Home</a>
                <a href="https://github.com/adi3433/CIVIC-AID-STARTUP-" target="_blank" class="text-white/70 no-underline text-sm font-medium hover:text-white transition-colors">GitHub</a>
                <button onclick="toggleInfo()" class="text-white/70 hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
            </div>
        </nav>
    </header>

    <main class="relative z-10 pt-28 px-6 pb-12">
        <div class="max-w-[900px] mx-auto">
            <!-- Hero Section -->
            <div class="text-center mb-8">
                <span class="inline-block text-xs font-medium text-white/60 bg-white/5 border border-white/[0.08] px-3 py-1.5 rounded tracking-wide mb-4">üîç AI INVESTIGATION ASSISTANT</span>
                <h1 class="text-4xl font-bold leading-tight text-white mb-3 tracking-tight">LeadGen AI</h1>
                <p class="text-sm text-white/60 leading-relaxed">AI-powered lead qualification and case analysis</p>
            </div>

            <!-- Chat Container -->
            <div class="bg-civic-card/60 backdrop-blur-xl border border-white/[0.08] rounded-2xl overflow-hidden shadow-2xl">
                <!-- Messages Area -->
                <div class="p-6 overflow-y-auto" style="min-height: 400px; max-height: 600px;" id="messages">
                    <!-- Welcome Screen -->
                    <div id="welcome-screen" class="text-center py-12">
                        <div class="text-6xl mb-6">üéØ</div>
                        <h2 class="text-2xl font-bold mb-4">Welcome to LeadGen AI</h2>
                        <p class="text-white/60 mb-8 max-w-md mx-auto">Your intelligent investigation assistant powered by Llama 3.3. Ask questions, analyze cases, or get recommendations.</p>
                        
                        <!-- Quick Prompts -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
                            <button onclick="handleQuickPrompt('Deepfake Fraud Investigation')" class="bg-civic-surface/80 hover:bg-civic-surface border border-white/10 hover:border-blue-500/50 rounded-xl p-4 text-left transition-all hover:-translate-y-1">
                                <div class="text-2xl mb-2">üïµÔ∏è</div>
                                <div class="font-semibold text-sm mb-1">Deepfake Fraud</div>
                                <div class="text-xs text-white/50">Investigation process</div>
                            </button>
                            <button onclick="handleQuickPrompt('Phishing Analysis')" class="bg-civic-surface/80 hover:bg-civic-surface border border-white/10 hover:border-blue-500/50 rounded-xl p-4 text-left transition-all hover:-translate-y-1">
                                <div class="text-2xl mb-2">üé£</div>
                                <div class="font-semibold text-sm mb-1">Phishing Analysis</div>
                                <div class="text-xs text-white/50">Campaign detection</div>
                            </button>
                            <button onclick="handleQuickPrompt('Cryptocurrency Scam')" class="bg-civic-surface/80 hover:bg-civic-surface border border-white/10 hover:border-blue-500/50 rounded-xl p-4 text-left transition-all hover:-translate-y-1">
                                <div class="text-2xl mb-2">‚Çø</div>
                                <div class="font-semibold text-sm mb-1">Crypto Scam</div>
                                <div class="text-xs text-white/50">Blockchain tracing</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-white/[0.08] p-5">
                    <div class="flex gap-3" id="input-wrapper">
                        <input type="text" id="lead-input" 
                            placeholder="Describe your case or ask a question..." 
                            class="flex-1 bg-civic-surface border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/40 focus:border-[#1FA3A3]/50 focus:outline-none focus:ring-2 focus:ring-[#1FA3A3]/20 transition-all">
                        <button id="send-btn" onclick="sendMessage()" disabled
                            class="bg-gradient-to-r from-[#1FA3A3] to-[#1a8e8e] hover:from-[#1a8e8e] hover:to-[#177878] disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold px-6 py-3 rounded-xl transition-all hover:shadow-lg hover:shadow-[#1FA3A3]/50 hover:-translate-y-0.5 flex items-center gap-2">
                            <span>Send</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="text-xs text-white/40 mt-2 text-center">
                        Powered by Fireworks AI ‚Ä¢ Llama 3.3 70B Instruct
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="relative z-10 text-center py-8 text-white/40 text-sm">
        <p>&copy; 2024 CivicAId. AI-Powered Investigation Platform.</p>
    </footer>

    <!-- Info Modal (hidden by default) -->
    <div id="info-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-6" onclick="toggleInfo()">
        <div class="bg-civic-card border border-white/10 rounded-2xl p-8 max-w-md" onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold mb-4">About LeadGen AI</h3>
            <p class="text-white/70 text-sm mb-4">LeadGen AI uses Fireworks AI's Llama 3.3 70B model to analyze investigation cases and provide actionable recommendations.</p>
            <p class="text-white/70 text-sm mb-4">To use this feature, you'll need a Fireworks AI API key (free tier available).</p>
            <button onclick="toggleInfo()" class="w-full bg-[#1FA3A3] hover:bg-[#1a8e8e] text-white font-semibold py-2 px-4 rounded-xl transition-all">Got it</button>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
        });

        const messagesContainer = document.getElementById('messages');
        const welcomeScreen = document.getElementById('welcome-screen');
        const leadInput = document.getElementById('lead-input');
        const sendBtn = document.getElementById('send-btn');
        const inputWrapper = document.getElementById('input-wrapper');
        let conversationHistory = [];

        // Input Validation
        leadInput.addEventListener('input', () => {
            sendBtn.disabled = !leadInput.value.trim();
        });

        // Key Press
        leadInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendBtn.disabled) {
                sendMessage();
            }
        });

        function toggleInfo() {
            const modal = document.getElementById('info-modal');
            modal.classList.toggle('hidden');
        }

        async function handleQuickPrompt(type) {
            const map = {
                'Deepfake Fraud Investigation': 'How do you approach a deepfake fraud case?',
                'Phishing Analysis': 'What\'s the process for analyzing a phishing campaign?',
                'Cryptocurrency Scam': 'How to investigate a cryptocurrency scam?'
            };
            const text = map[type];
            leadInput.value = text;
            await sendMessage();
        }

        function addMessage(role, content) {
            if (welcomeScreen.style.display !== 'none') {
                welcomeScreen.style.display = 'none';
            }

            const msgDiv = document.createElement('div');
            msgDiv.className = `flex gap-3 mb-4 ${role === 'user' ? 'justify-end' : ''}`;

            const avatar = document.createElement('div');
            avatar.className = `w-8 h-8 rounded-full flex items-center justify-center ${role === 'user' ? 'bg-[#1FA3A3]/20 order-2' : 'bg-blue-500/20'}`;
            
            if (role === 'user') {
                avatar.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>';
            } else {
                avatar.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>';
            }

            const contentDiv = document.createElement('div');
            contentDiv.className = `${role === 'user' ? 'bg-[#1FA3A3]/20 order-1' : 'bg-civic-surface/80'} rounded-2xl px-4 py-3 max-w-[80%] markdown-content`;

            if (content === null) {
                contentDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
                msgDiv.id = 'loading-msg';
            } else {
                if (role === 'ai') {
                    contentDiv.innerHTML = marked.parse(content);
                    requestAnimationFrame(() => {
                        mermaid.init(undefined, contentDiv.querySelectorAll('.language-mermaid'));
                    });
                } else {
                    contentDiv.textContent = content;
                }
            }

            msgDiv.appendChild(avatar);
            msgDiv.appendChild(contentDiv);
            messagesContainer.appendChild(msgDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeLoadingMessage() {
            const loading = document.getElementById('loading-msg');
            if (loading) loading.remove();
        }

        async function sendMessage() {
            const text = leadInput.value.trim();
            if (!text) return;

            leadInput.value = '';
            sendBtn.disabled = true;

            addMessage('user', text);
            conversationHistory.push({ role: 'user', content: text });

            addMessage('ai', null);

            try {
                let API_KEY = localStorage.getItem('civicaid_fireworks_api_key');

                if (!API_KEY || API_KEY === 'YOUR_FIREWORKS_API_KEY') {
                    API_KEY = prompt("Please enter your Fireworks AI API Key (starts with fw_...):");
                    if (API_KEY) {
                        localStorage.setItem('civicaid_fireworks_api_key', API_KEY);
                    } else {
                        throw new Error("API Key is required to use this feature.");
                    }
                }

                const response = await fetch('https://api.fireworks.ai/inference/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "accounts/fireworks/models/llama-v3p3-70b-instruct",
                        messages: [
                            {
                                role: "system",
                                content: "You are an expert investigative assistant for CivicAid. Analyze cases with precision."
                            },
                            {
                                role: "user",
                                content: `Analyze the following case and provide actionable recommendations:\n\n${text}`
                            }
                        ],
                        temperature: 0.6
                    })
                });

                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error("Rate Limit Exceeded (429). Please wait a moment.");
                    }
                    throw new Error(`Fireworks API Error: ${response.status}`);
                }

                const data = await response.json();
                const aiText = data.choices?.[0]?.message?.content || "I couldn't generate a response.";

                removeLoadingMessage();
                addMessage('ai', aiText);
                conversationHistory.push({ role: 'model', content: aiText });

            } catch (error) {
                console.error("API Error:", error);
                removeLoadingMessage();

                let errorMsg = `Error: ${error.message}`;
                if (error.message.includes('401')) {
                    errorMsg = "‚ö†Ô∏è Authentication Failed: Invalid API Key. Please check your key.";
                    localStorage.removeItem('civicaid_fireworks_api_key');
                } else if (error.message.includes('429')) {
                    errorMsg = "‚ö†Ô∏è System Busy (429): Please wait 30 seconds before retrying.";
                }

                addMessage('ai', errorMsg);
            }
        }

        // Motion.js animation on load
        window.addEventListener('load', () => {
            animate('.max-w-\\[900px\\] > *', { opacity: [0, 1] }, { duration: 1.5, easing: 'linear' });
        });
    </script>
</body>

</html>
