<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CivicAid Agentic Call - AI-powered voice agent for customer support, dispatch, and enterprise workflows">
    <title>Agentic Call AI | CivicAId</title>
    <link rel="icon" type="image/png" sizes="32x32" href="public/CivicLogo.png">
    <link rel="icon" type="image/png" sizes="64x64" href="public/CivicLogo.png">
    <link rel="icon" type="image/png" sizes="96x96" href="public/CivicLogo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="public/CivicLogo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'civic-dark': '#060a10',
                        'civic-surface': '#0a1018',
                        'civic-card': '#0f1922',
                    },
                    fontFamily: { sans: ['Inter','system-ui','sans-serif'] },
                }
            }
        }
    </script>
    <style>
        *,*::before,*::after{box-sizing:border-box}*{-webkit-font-smoothing:antialiased}
        html{scroll-behavior:smooth}body{background:#060a10;font-feature-settings:"cv02","cv03","cv04","cv11";overflow-x:hidden}

        #particle-canvas{position:fixed;inset:0;z-index:0;pointer-events:none}

        .ambient-cyan{background:radial-gradient(ellipse 80% 50% at 50% -10%,rgba(6,182,212,0.10) 0%,rgba(6,182,212,0.03) 40%,transparent 70%)}
        .ambient-side{background:radial-gradient(ellipse 40% 60% at 100% 30%,rgba(99,102,241,0.06) 0%,transparent 70%)}
        .ambient-bottom{background:radial-gradient(ellipse 60% 40% at 20% 100%,rgba(14,165,233,0.04) 0%,transparent 70%)}

        .glass-nav{background:rgba(6,10,16,0.75);backdrop-filter:blur(20px) saturate(1.8);-webkit-backdrop-filter:blur(20px) saturate(1.8);border-bottom:1px solid rgba(6,182,212,0.08)}

        .card-glass{
            background:linear-gradient(160deg,rgba(15,25,34,0.95) 0%,rgba(10,16,24,0.98) 100%);
            border:1px solid rgba(6,182,212,0.1);
            box-shadow:0 0 0 1px rgba(6,182,212,0.03) inset,0 4px 24px rgba(0,0,0,0.4),0 0 80px rgba(6,182,212,0.04);
            transition:transform 0.4s cubic-bezier(.22,1,.36,1),box-shadow 0.4s ease;
        }

        .status-gradient{background:linear-gradient(135deg,#06b6d4 0%,#6366f1 50%,#0ea5e9 100%)}

        .input-glow:focus{border-color:rgba(6,182,212,0.5)!important;box-shadow:0 0 0 3px rgba(6,182,212,0.1),0 0 20px rgba(6,182,212,0.08)}

        .call-btn{
            background:linear-gradient(135deg,#06b6d4 0%,#6366f1 100%);
            box-shadow:0 0 30px rgba(6,182,212,0.3),0 0 60px rgba(6,182,212,0.1);
            transition:all 0.3s ease;
            animation:callPulse 2.5s ease-in-out infinite;
        }
        .call-btn:hover{box-shadow:0 0 40px rgba(6,182,212,0.5),0 0 80px rgba(6,182,212,0.2);transform:scale(1.1)}
        @keyframes callPulse{0%,100%{box-shadow:0 0 30px rgba(6,182,212,0.3),0 0 60px rgba(6,182,212,0.1)}50%{box-shadow:0 0 40px rgba(6,182,212,0.5),0 0 80px rgba(6,182,212,0.2)}}

        @keyframes waveAnimation{0%,100%{height:20px}50%{height:40px}}
        .waveform-bar{animation:waveAnimation 1s ease-in-out infinite}

        .orbit-ring{position:absolute;border-radius:50%;border:1px solid rgba(6,182,212,0.06)}
        .orbit-ring-1{width:250px;height:250px;top:-30px;left:-50px;animation:orbitSpin 30s linear infinite}
        .orbit-ring-2{width:400px;height:400px;top:-120px;left:-150px;animation:orbitSpin 45s linear infinite reverse}
        @keyframes orbitSpin{to{transform:rotate(360deg)}}

        .agent-glow{animation:agentGlow 3s ease-in-out infinite alternate}
        @keyframes agentGlow{0%{filter:drop-shadow(0 0 15px rgba(6,182,212,0.3))}100%{filter:drop-shadow(0 0 25px rgba(99,102,241,0.4))}}

        .pulse-ring{
            position:absolute;border-radius:50%;border:2px solid rgba(6,182,212,0.15);
            animation:pulseRing 2.5s ease-out infinite;
        }
        .pulse-ring-2{animation-delay:0.8s}
        .pulse-ring-3{animation-delay:1.6s}
        @keyframes pulseRing{0%{transform:scale(0.8);opacity:1}100%{transform:scale(2);opacity:0}}

        /* Mode selector */
        .mode-selector{display:flex;gap:6px;padding:4px;background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid rgba(255,255,255,0.06)}
        .mode-btn{padding:8px 16px;border-radius:8px;font-size:0.8125rem;font-weight:500;color:rgba(255,255,255,0.5);cursor:pointer;transition:all 0.25s ease;border:none;background:transparent}
        .mode-btn.active{background:linear-gradient(135deg,rgba(6,182,212,0.15),rgba(99,102,241,0.15));color:#67e8f9;border:1px solid rgba(6,182,212,0.2)}
        .mode-btn:hover:not(.active){color:rgba(255,255,255,0.7);background:rgba(255,255,255,0.03)}

        .reveal{opacity:0;transform:translateY(24px)}

        .chat-scroll::-webkit-scrollbar{width:5px}.chat-scroll::-webkit-scrollbar-track{background:transparent}.chat-scroll::-webkit-scrollbar-thumb{background:rgba(6,182,212,0.15);border-radius:3px}
    </style>
</head>
<body class="text-white font-sans leading-relaxed min-h-screen">
    <canvas id="particle-canvas"></canvas>
    <div class="fixed inset-0 pointer-events-none z-[1] ambient-cyan"></div>
    <div class="fixed inset-0 pointer-events-none z-[1] ambient-side"></div>
    <div class="fixed inset-0 pointer-events-none z-[1] ambient-bottom"></div>

    <header class="fixed top-0 left-0 right-0 z-50 glass-nav">
        <nav class="flex items-center justify-between h-16 px-6 lg:px-10 max-w-[1280px] mx-auto">
            <a href="landing.html" class="flex items-center gap-2.5 no-underline shrink-0 group">
                <img src="public/CivicLogo.png" alt="CivicAId" class="w-8 h-8 object-contain transition-transform group-hover:scale-110">
                <span class="text-[0.9375rem] font-semibold text-white">CivicAId</span>
            </a>
            <div class="flex items-center gap-6">
                <a href="landing.html" class="text-white/50 text-sm font-medium hover:text-white transition-colors no-underline">Home</a>
                <a href="https://github.com/adi3433/CIVIC-AID-STARTUP-" target="_blank" class="text-white/50 text-sm font-medium hover:text-white transition-colors no-underline">GitHub</a>
                <div class="flex items-center gap-2 text-xs font-medium px-3 py-1.5 rounded-full bg-cyan-500/10 border border-cyan-500/20 text-cyan-400">
                    <span class="w-1.5 h-1.5 bg-cyan-500 rounded-full shadow-[0_0_8px_rgba(6,182,212,0.6)] animate-pulse"></span>
                    Agentic AI
                </div>
            </div>
        </nav>
    </header>

    <main class="relative z-10 pt-28 pb-20">
        <div class="max-w-[580px] mx-auto px-6">
            <!-- Hero -->
            <div class="text-center mb-8">
                <div class="reveal inline-flex items-center gap-2 px-3 py-1.5 rounded-full mb-6" style="background:rgba(6,182,212,0.06);border:1px solid rgba(6,182,212,0.12);">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500 animate-pulse"></span>
                    <span class="text-[0.6875rem] font-medium tracking-wide text-cyan-400/80 uppercase">AI Voice Agent</span>
                </div>
                <h1 class="reveal text-[clamp(2rem,4.5vw,3rem)] font-extrabold tracking-[-0.035em] leading-[1.1] text-white mb-4">
                    Agentic<br><span class="bg-gradient-to-r from-cyan-400 via-sky-400 to-indigo-400 bg-clip-text text-transparent">Call</span>
                </h1>
                <p class="reveal text-base text-white/50 leading-relaxed max-w-[420px] mx-auto">AI-powered voice agent for support, dispatch, and enterprise workflows</p>
            </div>

            <!-- Mode Selector -->
            <div class="reveal flex justify-center mb-6">
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="support" onclick="switchMode('support')">üí¨ Support</button>
                    <button class="mode-btn" data-mode="dispatch" onclick="switchMode('dispatch')">üö® Dispatch</button>
                    <button class="mode-btn" data-mode="enterprise" onclick="switchMode('enterprise')">üè¢ Enterprise</button>
                </div>
            </div>

            <!-- Dispatch Card -->
            <div class="card-glass rounded-2xl overflow-hidden reveal" id="dispatch-card">
                <!-- Status Bar -->
                <div class="status-gradient px-5 py-4 flex justify-between items-center">
                    <span class="font-semibold text-sm" id="status-text">Agentic Call Center</span>
                    <div class="flex items-center gap-2 text-xs">
                        <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                        <span id="status-label">Ready</span>
                    </div>
                </div>

                <!-- Idle State -->
                <div class="p-10 text-center" id="idle-state">
                    <div class="relative inline-block mb-8">
                        <div class="pulse-ring w-32 h-32 -top-4 -left-4"></div>
                        <div class="pulse-ring pulse-ring-2 w-32 h-32 -top-4 -left-4"></div>
                        <div class="pulse-ring pulse-ring-3 w-32 h-32 -top-4 -left-4"></div>
                        <!-- Agent icon -->
                        <div class="relative z-10 agent-glow">
                            <svg class="w-16 h-16 mx-auto" fill="none" viewBox="0 0 64 64">
                                <circle cx="32" cy="32" r="28" stroke="url(#agentGrad)" stroke-width="2" fill="rgba(6,182,212,0.06)"/>
                                <path d="M22 28c0-5.523 4.477-10 10-10s10 4.477 10 10v2c0 2.21-1.79 4-4 4h-1a3 3 0 01-3-3v-2a3 3 0 013-3h1.5c-.3-3.3-3.1-6-6.5-6s-6.2 2.7-6.5 6H27a3 3 0 013 3v2a3 3 0 01-3 3h-1c-2.21 0-4-1.79-4-4v-2z" fill="rgba(6,182,212,0.6)"/>
                                <path d="M24 38c0 0 2.5 4 8 4s8-4 8-4" stroke="rgba(6,182,212,0.5)" stroke-width="1.5" stroke-linecap="round"/>
                                <defs><linearGradient id="agentGrad" x1="4" y1="4" x2="60" y2="60"><stop stop-color="#06b6d4"/><stop offset="1" stop-color="#6366f1"/></linearGradient></defs>
                            </svg>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold mb-3" id="idle-title">Start AI Call</h2>
                    <p class="text-white/50 mb-8" id="idle-desc">Press the button below to connect with our AI voice agent</p>
                    <button onclick="initiateCall()" class="call-btn w-24 h-24 rounded-full text-4xl mx-auto flex items-center justify-center border-0 cursor-pointer text-white">
                        <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg>
                    </button>
                </div>

                <!-- Connected State -->
                <div class="hidden" id="connected-state">
                    <div class="p-5 overflow-y-auto flex flex-col gap-3 min-h-[300px] max-h-[400px] chat-scroll" id="conversation"></div>
                    <div class="hidden justify-center items-end gap-1 h-16 px-5" id="waveform">
                        <div class="waveform-bar w-1 bg-cyan-500 rounded-full" style="animation-delay:0s"></div>
                        <div class="waveform-bar w-1 bg-cyan-500 rounded-full" style="animation-delay:0.1s"></div>
                        <div class="waveform-bar w-1 bg-cyan-500 rounded-full" style="animation-delay:0.2s"></div>
                        <div class="waveform-bar w-1 bg-cyan-400 rounded-full" style="animation-delay:0.3s"></div>
                        <div class="waveform-bar w-1 bg-indigo-400 rounded-full" style="animation-delay:0.4s"></div>
                        <div class="waveform-bar w-1 bg-indigo-400 rounded-full" style="animation-delay:0.5s"></div>
                        <div class="waveform-bar w-1 bg-cyan-400 rounded-full" style="animation-delay:0.6s"></div>
                        <div class="waveform-bar w-1 bg-cyan-500 rounded-full" style="animation-delay:0.7s"></div>
                    </div>
                    <div class="p-5 border-t border-white/[0.06]">
                        <div class="flex gap-3 mb-3">
                            <button id="mic-btn" onclick="toggleRecording()" class="w-12 h-12 rounded-full bg-white/[0.03] hover:bg-cyan-500/20 border border-white/10 text-2xl flex items-center justify-center transition-all" title="Voice Input">üé§</button>
                            <input type="text" id="text-input" class="input-glow flex-1 bg-white/[0.03] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none transition-all" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
                            <button id="send-btn" onclick="sendMessage()" disabled class="w-12 h-12 rounded-full bg-gradient-to-br from-cyan-500 to-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-xl flex items-center justify-center transition-all hover:scale-110 text-white border-0 cursor-pointer">‚û§</button>
                        </div>
                        <div class="text-center">
                            <button onclick="endCall()" class="w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 text-2xl transition-all hover:scale-110 shadow-lg shadow-red-500/20 border-0 cursor-pointer text-white" title="End Call">‚úï</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Call Button -->
            <div class="hidden mt-6 text-center" id="new-call-section">
                <button onclick="initiateCall()" class="card-glass text-white px-8 py-4 rounded-xl font-semibold hover:border-cyan-500/30 transition-all border border-white/10 cursor-pointer">
                    <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg>
                    New Agentic Call
                </button>
            </div>
        </div>
    </main>

    <footer class="relative z-10 text-center py-8 text-white/30 text-sm border-t border-white/[0.04]">
        <p>&copy; 2026 CivicAId. AI-Powered Agentic Call Platform.</p>
    </footer>

    <script>
        // ‚îÄ‚îÄ Particle System (Cyan/Indigo) ‚îÄ‚îÄ
        (function(){const c=document.getElementById('particle-canvas'),x=c.getContext('2d');let p=[];const C=['rgba(6,182,212,','rgba(99,102,241,','rgba(14,165,233,','rgba(129,140,248,'];function r(){c.width=window.innerWidth;c.height=window.innerHeight}window.addEventListener('resize',r);r();class P{constructor(){this.reset()}reset(){this.x=Math.random()*c.width;this.y=Math.random()*c.height;this.s=Math.random()*2.5+0.5;this.sx=(Math.random()-0.5)*0.35;this.sy=(Math.random()-0.5)*0.25;this.c=C[Math.floor(Math.random()*C.length)];this.o=Math.random()*0.3+0.08;this.p=Math.random()*Math.PI*2;this.ps=Math.random()*0.02+0.005}update(){this.x+=this.sx;this.y+=this.sy;this.p+=this.ps;if(this.x<0||this.x>c.width||this.y<0||this.y>c.height)this.reset()}draw(){const o=this.o*(0.6+Math.sin(this.p)*0.4);x.beginPath();x.arc(this.x,this.y,this.s,0,Math.PI*2);x.fillStyle=this.c+o+')';x.fill()}}for(let i=0;i<60;i++)p.push(new P());function d(){for(let i=0;i<p.length;i++)for(let j=i+1;j<p.length;j++){const dx=p[i].x-p[j].x,dy=p[i].y-p[j].y,di=Math.sqrt(dx*dx+dy*dy);if(di<130){x.beginPath();x.strokeStyle=`rgba(6,182,212,${0.04*(1-di/130)})`;x.lineWidth=0.5;x.moveTo(p[i].x,p[i].y);x.lineTo(p[j].x,p[j].y);x.stroke()}}}function l(){x.clearRect(0,0,c.width,c.height);p.forEach(i=>{i.update();i.draw()});d();requestAnimationFrame(l)}l()})();

        const {animate, inView} = Motion;

        // 3D tilt on dispatch card
        const dc=document.getElementById('dispatch-card');
        if(dc){dc.addEventListener('mousemove',e=>{const r=dc.getBoundingClientRect(),x=(e.clientX-r.left)/r.width-0.5,y=(e.clientY-r.top)/r.height-0.5;dc.style.transform=`perspective(1200px) rotateY(${x*6}deg) rotateX(${-y*4}deg)`});dc.addEventListener('mouseleave',()=>{dc.style.transform='perspective(1200px) rotateY(0deg) rotateX(0deg)'})}

        // ‚îÄ‚îÄ Mode System ‚îÄ‚îÄ
        let currentMode = 'support';
        const modes = {
            support: {
                title: 'Start Support Call',
                desc: 'Connect with our AI support agent for assistance',
                greeting: 'Hello! I\'m your AI support agent. How can I help you today?',
                statusText: 'Support Center',
                placeholder: 'Describe your issue...',
                systemMsg: 'Connected to AI Support Agent'
            },
            dispatch: {
                title: 'Start Emergency Call',
                desc: 'Connect with our AI dispatcher for emergency services',
                greeting: 'Emergency Dispatch. What is your emergency?',
                statusText: 'Dispatch Center',
                placeholder: 'Type your emergency...',
                systemMsg: 'Connected to Emergency Dispatch AI'
            },
            enterprise: {
                title: 'Start Enterprise Call',
                desc: 'Connect with our AI enterprise agent for workflow support',
                greeting: 'Enterprise AI Agent ready. What workflow can I assist you with?',
                statusText: 'Enterprise Agent',
                placeholder: 'Describe your workflow need...',
                systemMsg: 'Connected to Enterprise AI Agent'
            }
        };

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            const m = modes[mode];
            document.getElementById('idle-title').textContent = m.title;
            document.getElementById('idle-desc').textContent = m.desc;
            // Reset if in idle state
            if (!document.getElementById('idle-state').classList.contains('hidden')) {
                document.getElementById('status-text').textContent = 'Agentic Call Center';
            }
        }

        // ‚îÄ‚îÄ Core Call Functionality (preserved from original dispatch) ‚îÄ‚îÄ
        let isRecording = false, recognition = null, messageCount = 0, currentClassification = null;

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SR();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('text-input').value = transcript;
                    sendMessage();
                };
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    stopRecording();
                };
                recognition.onend = () => { stopRecording(); };
            }
        }

        function initiateCall() {
            const m = modes[currentMode];
            document.getElementById('idle-state').classList.add('hidden');
            document.getElementById('connected-state').classList.remove('hidden');
            document.getElementById('new-call-section').classList.add('hidden');
            document.getElementById('status-text').textContent = m.statusText || 'Connected';
            document.getElementById('status-label').textContent = 'Active Call';
            document.getElementById('text-input').placeholder = m.placeholder || 'Type your message...';
            messageCount = 0;
            currentClassification = null;
            document.getElementById('conversation').innerHTML = '';
            addMessage('system', m.systemMsg);
            setTimeout(() => {
                addMessage('assistant', m.greeting);
                speakText(m.greeting);
            }, 500);
        }

        function endCall() {
            document.getElementById('idle-state').classList.add('hidden');
            document.getElementById('connected-state').classList.add('hidden');
            document.getElementById('new-call-section').classList.remove('hidden');
            document.getElementById('status-text').textContent = 'Call Ended';
            document.getElementById('status-label').textContent = 'Offline';
            const endMsg = currentMode === 'dispatch'
                ? 'Call ended. Emergency services have been notified.'
                : 'Call ended. Thank you for using CivicAid.';
            addMessage('system', endMsg);
            if (isRecording) stopRecording();
        }

        function toggleRecording() {
            if (!recognition) { alert('Speech recognition is not supported in your browser'); return; }
            isRecording ? stopRecording() : startRecording();
        }

        function startRecording() {
            isRecording = true;
            document.getElementById('mic-btn').classList.add('bg-cyan-500');
            document.getElementById('waveform').classList.remove('hidden');
            document.getElementById('waveform').classList.add('flex');
            recognition.start();
        }

        function stopRecording() {
            isRecording = false;
            document.getElementById('mic-btn').classList.remove('bg-cyan-500');
            document.getElementById('waveform').classList.add('hidden');
            document.getElementById('waveform').classList.remove('flex');
            if (recognition) recognition.stop();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') sendMessage();
            document.getElementById('send-btn').disabled = !event.target.value.trim();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const inp = document.getElementById('text-input');
            if (inp) inp.addEventListener('input', (e) => {
                document.getElementById('send-btn').disabled = !e.target.value.trim();
            });
        });

        async function sendMessage() {
            const input = document.getElementById('text-input');
            const text = input.value.trim();
            if (!text) return;
            input.value = '';
            document.getElementById('send-btn').disabled = true;
            addMessage('user', text);
            messageCount++;
            showTypingIndicator();

            try {
                const response = await fetch('/api/dispatch/process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, messageCount, classification: currentClassification, mode: currentMode })
                });
                const data = await response.json();
                hideTypingIndicator();
                if (data.classification && !currentClassification) {
                    currentClassification = data.classification;
                }
                addMessage('assistant', data.response);
                speakText(data.response);
            } catch (error) {
                console.error('Error:', error);
                hideTypingIndicator();
                const fallback = getFallbackResponse(text, messageCount);
                addMessage('assistant', fallback);
                speakText(fallback);
            }
        }

        function addMessage(type, text) {
            const conv = document.getElementById('conversation');
            const div = document.createElement('div');
            if (type === 'system') {
                div.className = 'text-center text-xs text-white/30 py-2';
                div.textContent = text;
            } else if (type === 'assistant') {
                div.className = 'max-w-[85%] self-start bg-white/[0.03] border border-white/[0.06] px-4 py-3 rounded-2xl rounded-tl-sm text-sm';
                div.textContent = text;
            } else if (type === 'user') {
                div.className = 'max-w-[85%] self-end bg-gradient-to-br from-cyan-500 to-indigo-500 px-4 py-3 rounded-2xl rounded-tr-sm text-sm';
                div.textContent = text;
            }
            conv.appendChild(div);
            conv.scrollTop = conv.scrollHeight;
            // Animate in
            div.style.opacity = '0';
            div.style.transform = 'translateY(8px)';
            requestAnimationFrame(() => {
                div.style.transition = 'all 0.3s ease';
                div.style.opacity = '1';
                div.style.transform = 'translateY(0)';
            });
        }

        function showTypingIndicator() {
            const conv = document.getElementById('conversation');
            const ind = document.createElement('div');
            ind.id = 'typing-indicator';
            ind.className = 'flex items-center gap-2 px-4 py-3 bg-white/[0.03] border border-white/[0.06] rounded-2xl rounded-tl-sm max-w-[85%] self-start';
            ind.innerHTML = '<div class="flex gap-1"><span class="w-2 h-2 bg-cyan-400/50 rounded-full animate-bounce" style="animation-delay:0s"></span><span class="w-2 h-2 bg-cyan-400/50 rounded-full animate-bounce" style="animation-delay:0.2s"></span><span class="w-2 h-2 bg-cyan-400/50 rounded-full animate-bounce" style="animation-delay:0.4s"></span></div>';
            conv.appendChild(ind);
            conv.scrollTop = conv.scrollHeight;
        }

        function hideTypingIndicator() {
            const ind = document.getElementById('typing-indicator');
            if (ind) ind.remove();
        }

        function getFallbackResponse(text, mc) {
            const lt = text.toLowerCase();

            // Dispatch mode ‚Äî emergency classification
            if (currentMode === 'dispatch') {
                if (lt.includes('fire') || lt.includes('burning')) {
                    currentClassification = 'fire';
                    return "Fire emergency noted. Fire brigade is being dispatched. What is your exact location?";
                } else if (lt.includes('medical') || lt.includes('heart') || lt.includes('hurt') || lt.includes('injured')) {
                    currentClassification = 'medical';
                    return "Medical emergency. Ambulance is being dispatched. What is your location?";
                } else if (lt.includes('robbery') || lt.includes('attack') || lt.includes('crime') || lt.includes('police')) {
                    currentClassification = 'police';
                    return "Police are being dispatched. Are you in a safe location? What is your address?";
                } else if (lt.includes('street') || lt.includes('road') || lt.includes('building') || lt.includes('address')) {
                    return "Location received. Emergency services are on their way. ETA 5 minutes. Stay on the line.";
                } else if (mc > 3) {
                    return "Help is on the way. Please stay calm and don't hang up until emergency services arrive.";
                } else {
                    return "I understand. What type of emergency is this - medical, fire, or police? And what is your location?";
                }
            }

            // Support mode
            if (currentMode === 'support') {
                if (lt.includes('account') || lt.includes('login') || lt.includes('password')) {
                    return "I can help with your account. Could you provide your registered email or account ID so I can look into this for you?";
                } else if (lt.includes('billing') || lt.includes('payment') || lt.includes('invoice')) {
                    return "I can assist with billing. Let me pull up your billing details. Could you confirm which invoice or payment you're referring to?";
                } else if (lt.includes('bug') || lt.includes('error') || lt.includes('broken') || lt.includes('not working')) {
                    return "I see you're experiencing a technical issue. Can you describe the exact error message or steps to reproduce the problem?";
                } else if (lt.includes('feature') || lt.includes('request') || lt.includes('suggestion')) {
                    return "Thank you for the feedback! I've noted your feature request. Our product team reviews these weekly. Anything else I can help with?";
                } else if (mc > 3) {
                    return "I'm escalating this to a human agent who can assist you further. Your reference number is #" + Math.floor(Math.random() * 90000 + 10000) + ". Is there anything else?";
                } else {
                    return "Thank you for reaching out. Could you provide more details so I can route your request to the right department?";
                }
            }

            // Enterprise mode
            if (currentMode === 'enterprise') {
                if (lt.includes('onboarding') || lt.includes('setup') || lt.includes('deploy')) {
                    return "I can guide you through the setup process. Which CivicAid module would you like to deploy ‚Äî WhatsApp Bot, Lead Analysis, Education Suite, or Dispatch?";
                } else if (lt.includes('api') || lt.includes('integration') || lt.includes('webhook')) {
                    return "Our API documentation is available at /docs. I can help configure webhooks or set up integrations with your existing systems. Which platform are you integrating with?";
                } else if (lt.includes('scale') || lt.includes('performance') || lt.includes('load')) {
                    return "CivicAid supports horizontal scaling across regions. Current infrastructure handles 10K+ concurrent sessions. What's your expected load?";
                } else if (lt.includes('compliance') || lt.includes('security') || lt.includes('gdpr')) {
                    return "CivicAid is SOC 2 Type II certified with end-to-end encryption. Data residency options available for EU, US, and APAC regions. Want the full compliance whitepaper?";
                } else if (mc > 3) {
                    return "I'll connect you with our enterprise solutions team. They'll follow up within 24 hours. Reference: ENT-" + Date.now().toString(36).toUpperCase();
                } else {
                    return "Welcome to CivicAid Enterprise. I can help with deployment, integrations, scaling, or compliance. What would you like to discuss?";
                }
            }

            return "I'm here to help. Could you tell me more about what you need?";
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        }

        // Initialize
        initSpeechRecognition();

        // ‚îÄ‚îÄ Reveal ‚îÄ‚îÄ
        window.addEventListener('load', () => {
            document.querySelectorAll('.reveal').forEach((el, i) => {
                inView(el, () => {
                    animate(el, { opacity: [0, 1], y: [24, 0] }, { duration: 0.85, delay: 0.1 * (i % 6), easing: [0.22, 1, 0.36, 1] });
                }, { amount: 0.15 });
            });
        });
    </script>
</body>
</html>
